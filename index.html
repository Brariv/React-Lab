<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Memoria</title>
    
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>

    <link rel="stylesheet" href="cards.css">

    <div id="root">
        <!-- React will render the app here -->
    </div>

    <script type="text/babel">
        const { useEffect } = React;
        const { useState } = React;
        

        function App() {

            const [status, setStatus] = useState({
                started: false, finished: false, attempts: 1
            });

            const [cards, setCards] = useState([
                { id: 1, text: 'Card 1', flipped: false , color: '#2980b9', found: false},
                { id: 2, text: 'Card 2', flipped: false , color: '#2980b9', found: false},
                { id: 3, text: 'Card 1', flipped: false , color: '#2980b9', found: false},
                { id: 4, text: 'Card 2', flipped: false , color: '#2980b9', found: false},
                { id: 5, text: 'Card 3', flipped: false , color: '#2980b9', found: false},
                { id: 6, text: 'Card 4', flipped: false , color: '#2980b9', found: false},
                { id: 7, text: 'Card 3', flipped: false , color: '#2980b9', found: false},
                { id: 8, text: 'Card 4', flipped: false , color: '#2980b9', found: false},
                { id: 9, text: 'Card 5', flipped: false , color: '#2980b9', found: false},
                { id: 10, text: 'Card 6', flipped: false , color: '#2980b9', found: false},
                { id: 11, text: 'Card 5', flipped: false , color: '#2980b9', found: false},
                { id: 12, text: 'Card 6', flipped: false , color:'#2980b9', found:false},
                { id: 13, text: 'Card 7', flipped: false , color:'#2980b9', found:false},
                { id: 14, text: 'Card 8', flipped: false , color:'#2980b9', found:false},
                { id: 15, text: 'Card 7', flipped: false , color:'#2980b9', found:false},
                { id: 16, text: 'Card 8', flipped: false , color:'#2980b9', found:false}

            ]);

            const shuffleCards = () => {
                const shuffledCards = [...cards].sort(() => Math.random() - 0.5);
                setCards(shuffledCards);
            };

            const restartGame = () => {
                setTimeout(() => {
                    setStatus({ ...status, started: true, finished: false, attempts: 1 });
                }, 1000);
                setCards(prev => [...prev.map(card => ({...card, flipped: false, found: false, color: '#2980b9'}))].sort(() => Math.random() - 0.5));
                
            };

            const verifyWin = () => {
                if (cards.every(card => card.found)) {
                    alert('You win!');
                    setStatus({ ...status, finished: true});
                }
            };

            const [flippedCards, setFlippedCards] = useState([]);


            useEffect(() => {
                shuffleCards();
            }, []);

            

            useEffect(() => {
                verifyWin();
                if (status.finished) {
                    return;
                }
            }, [cards]);


            const flipCard = (id) => {
                if (cards.find(card => card.id === id).found) {
                    return; // If already found or flipped, do nothing
                }

                const newCards = cards.map(card => 
                    card.id === id ? { ...card, flipped: true } : card
                );
                setCards(newCards);

                const flippedCards = newCards.filter(card => card.flipped && !card.found);

                    if (flippedCards.length === 2) {
                        if (flippedCards[0].text === flippedCards[1].text) {
                            // If they match
                            setTimeout(() => {
                                setCards(cards => 
                                    cards.map(card => 
                                        (card.id === flippedCards[0].id || card.id === flippedCards[1].id)
                                            ? { ...card,  color: '#2ecc71', found: true }
                                            : card
                                    )
                                );
                            }, 500);
                        } else {
                            // If they don't match
                            setCards(cards => cards.map(card => (card.id === flippedCards[0].id || card.id === flippedCards[1].id)? { ...card, color:'#f60e0e'}: card));
                            setTimeout(() => {
                                setCards(cards => 
                                    cards.map(card => 
                                        (card.id === flippedCards[0].id || card.id === flippedCards[1].id)
                                            ? { ...card, color:'#2980b9', flipped: false }
                                            : card
                                    )
                                );
                            }, 1000);
                            setStatus(prev => ({ ...prev, attempts: prev.attempts + 1 }));
                        }
                    }
                };

            

            return (
                <div className="game">
                    {!status.started && (
                        <div className="start-container">
                            <h1>Start Game</h1>
                            <button onClick={() => setStatus({ ...status, started: true })}>Start Game</button>
                        </div>
                    )}
                    {status.started && !status.finished && (
                        <div className="restart-container">
                            <button onClick={() => restartGame()}>Restart Game</button>
                            <h1>React Memory Game</h1>
                            <p>Attempts: {status.attempts}</p>
                        
                            <div className="container">
                                {cards.map(card => (
                                    <div key={card.id} className={`card ${card.flipped ? 'is-flipped' : ''}`} onClick={() => flipCard(card.id)}>
                                        <div className="card-inner">
                                            <div className="card-front">
                                                <p>back</p>
                                            </div>
                                            <div className="card-back" style={{ backgroundColor: card.color }}>
                                                <p>{card.text}</p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    {status.finished && (
                        <div className="finish-container">
                            <h1>Game Over</h1>
                            <p>Attempts: {status.attempts}</p>
                            <button onClick={() => restartGame()}>Play Again</button>
                        </div>
                    )}
                    
                    
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>